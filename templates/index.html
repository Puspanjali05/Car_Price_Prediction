<!doctype html>
<html lang="en">
<head>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">


    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">


    <title>Car Price Predictor</title>
</head>
<body class="bg-dark">
<div class="container mt-5">
    <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">

            <div class="card">
                <div class="card-header text-center">
                    <h2>Welcome to Car Price Predictor</h2>
                </div>

                <div class="card-body text-center">
                    <form method="post" accept-charset="utf-8">
                        <div class="col-12 form-group" style="text-align: center">
                            <label><b>Select Company: </b></label>
                            <select class="selectpicker form-control" id="company" name="company" required="1" onchange="load_car_models(this.id, 'car_model')">
                                {% for company in companies %}

                                <option value="{{ company }}">{{ company }}</option>

                                {% endfor %}
                            </select>
                        </div>

                        <div class="col-12 form-group" style="text-align: center">
                            <label><b>Select Model: </b></label>
                            <select class="selectpicker form-control" id="car_model" name="car_model" required="1">
                                {% for model in car_models %}

                                <option value="{{ model }}">{{ model }}</option>

                                {% endfor %}
                            </select>
                        </div>

                        <div class="col-12 form-group" style="text-align: center">
                            <label><b>Select Year of Purchase: </b></label>
                            <select class="selectpicker form-control" id="year" name="year" required="1">
                                {% for year in years %}
                                    <option value="{{year}}">{{year}}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="col-12 form-group" style="text-align: center">
                            <label><b>Select Fuel Type: </b></label>
                            <select class="selectpicker form-control" id="fuel_type" name="fuel_type" required="1">
                                {% for fuel_type in fuel_types %}
                                    <option value="{{fuel_type}}">{{fuel_type}}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="col-12 form-group" style="text-align: center">
                            <label><b>Enter Number of Kilometers Travelled: </b></label>
                            <input class="form-control" type="text" id="kilo_driven" name="kilo_driven" placeholder="Enter number of kilometers travelled"></input>
                        </div>

                        <div class="col-12 form-group" style="text-align: center">
                        <button class="btn btn-primary form-control" onclick="send_data()">Predict Price</button>
                        </div>

                    </form>
                    <br>

                    <div class="row">
                        <div class="col-12" style="text-align: center">
                            <h3><span id="prediction"></span></h3>
                        </div>
                    </div>
                </div>



            </div>

        </div>
    </div>
</div>

</body>

<script>
function load_car_models(company_id, car_model_id){
    var company = document.getElementById(company_id).value;
    var car_model = document.getElementById(car_model_id);

    car_model.innerHTML = "";

    {% for model in car_models %}
        if ("{{ model }}".startsWith(company)){
            var newOption = document.createElement("option");
            newOption.value = "{{ model }}";
            newOption.innerHTML = "{{ model }}";
            car_model.add(newOption);
        }
    {% endfor %}
}

function form_handler(event) {
    event.preventDefault();
}

function send_data() {
    //Suppress from default behaviour
    document.querySelector('form').addEventListener('submit', form_handler);
    //Send and receive data to predict
    var fd = new FormData(document.querySelector('form'));

    var xhr = new XMLHttpRequest();

    xhr.open('POST', '/predict', true);
    document.getElementById("prediction").innerHTML="Wait! Predicting Price...";

    xhr.onreadystatechange = function(){
        if(xhr.readyState == XMLHttpRequest.DONE){
            document.getElementById("prediction").innerHTML="Prediction: â‚¹"+ xhr.responseText;
        }
    }
    xhr.onload=function(){};
    xhr.send(fd);
}

</script>


<!--    <h1>Hello, world!</h1>-->

    <!-- Option 2: jQuery, Popper.js, and Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
            integrity="sha384-DfXdWdNht2qCkCmZJLdnOjFkWDXLI4sdAl4kzbIRbkIuAeGHNirMRHkRkNvMNFVw"
            crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
            integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
            crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"
            integrity="sha384-w1Q4orY1Bmq6k0dQXpressnX2VVaodIZ6Tn6PvxI6Bfq5lHppZrgYBBjKs64+h0c"
            crossorigin="anonymous"></script>

</body>
</html>
